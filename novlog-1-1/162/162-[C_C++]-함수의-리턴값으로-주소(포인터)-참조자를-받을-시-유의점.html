
<meta charset="utf-8">
<html lang="ko">
<head>
    <link rel="stylesheet" type="text/css" href="./../style.css" />
    <title>[C/C++] 함수의 리턴값으로 주소(포인터) 참조자를 받을 시 유의점</title>
</head>
<body id="tt-body-page" class="">
<div id="wrap" class="wrap-right">
    <div id="container">
        <main class="main ">
            <div class="area-main">
                <div class="area-view">
                    <div class="article-header">
                        <div class="inner-article-header">
                            <div class="box-meta">
                                <h2 class="title-article">[C/C++] 함수의 리턴값으로 주소(포인터) 참조자를 받을 시 유의점</h2>
                                <div class="box-info">
                                    <p class="category">? Archive/C&C++</p>
                                    <p class="date">2022-02-08 20:00:40</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="article-view">
                        <div class="contents_style">
                            <p style="text-align: center;" data-ke-size="size16"><span style="background-color: #99cefa;"><b><span style="font-family: 'Nanum Gothic'; color: #000000;">*개인적인 공부 내용을 기록하는 용도로 작성한 글 이기에 잘못된 내용을 포함하고 있을 수 있습니다.</span></b></span></p>
<p style="text-align: center;" data-ke-size="size18"><b><span style="font-family: 'Nanum Gothic'; color: #000000;">#1 Return By Value</span></b></p>
<p style="text-align: center;" data-ke-size="size18"><b><span style="font-family: 'Nanum Gothic'; color: #000000;">#2 Return By Address / Reference</span></b></p>
<hr contenteditable="false" data-ke-type="horizontalRule" data-ke-style="style5" />
<p data-ke-size="size18"><b><span style="font-family: 'Nanum Gothic'; color: #ffffff; background-color: #333333;">#1 Return By Value</span></b></p>
<p data-ke-size="size16"><span style="font-family: 'Nanum Gothic'; color: #000000;">getValue 함수는 값(Value)을 반환하는 간단한 Return-By-Value 함수입니다. Return-By-Value 함수는 <b>복사 과정이 많이 일어나서 비효율적</b>이라는 단점이 있습니다. 물론 아래 코드처럼 간단한 케이스는 상관 없지만 <b>배열이나 구조체 등 데이터가 많은 자료형을 반환할 때는 문제가 발생할 수 있습니다.</b></span></p>
<p data-ke-size="size16">&nbsp;</p>
<pre id="code_1644315547907" class="c++ arduino" data-ke-language="c++" data-ke-type="codeblock"><code>#include &lt;iostream&gt;
using namespace std;

// return by value
int getValue(int x)
{
	int value = x * 2;
	return value;
}

int main(){
	int value = getValue(3);
	return 0;
}</code></pre>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size18"><b><span style="font-family: 'Nanum Gothic'; color: #ffffff; background-color: #333333;">#2 Return By Address / Reference</span></b></p>
<p data-ke-size="size16"><span style="font-family: 'Nanum Gothic'; color: #000000;">다음으로 함수의 반환값으로 포인터 즉, 주소를 반환하는 케이스입니다.</span></p>
<pre id="code_1644315947245" class="c++ arduino" data-ke-language="c++" data-ke-type="codeblock"><code>#include &lt;iostream&gt;
using namespace std;

// return by address
int* getAddress(int x)
{
	int value = x * 2;
	return &amp;value;
}</code></pre>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16"><span style="font-family: 'Nanum Gothic'; color: #000000;">getAddress 함수의 리턴값을 받는 방법은 2가지를 떠올릴 수 있습니다. 첫 번째는 <span style="background-color: #333333; color: #ffffff;">*(de-referencing) 연산자를 이용해 리턴값을 받는 방법</span>입니다.</span></p>
<pre id="code_1644316017654" class="c++ arduino" data-ke-language="c++" data-ke-type="codeblock"><code>int main(){
	int value = *getAddress(5);
	return 0;
}</code></pre>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16"><span style="font-family: 'Nanum Gothic'; color: #000000;">하지만 이 방식은 위험한 생각입니다. 왜냐하면 getAddress 함수의 지역변수 value는 getAddress 함수가 종료되면 메모리가 사라지기 때문입니다. 이처럼 <b>사라질 변수를 de-referencing 하는 것은 큰 위험이 있습니다.</b></span></p>
<p><figure class="imageblock alignLeft" >
    <span data-lightbox="lightbox">
        <img src="./img/img.png"  />
    </span>
    <figcaption></figcaption>
</figure></p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16"><span style="font-family: 'Nanum Gothic'; color: #000000;">실제로 value에 들어있는 값을 출력해 보면 가비지 값(예상치 못한 쓰레기값)이 출력됩니다.</span></p>
<pre id="code_1644316478681" class="c++ arduino" data-ke-language="c++" data-ke-type="codeblock"><code>#include &lt;iostream&gt;
using namespace std;

// return by address
int* getAddress(int x)
{
	int value = x * 2;
	return &amp;value;
}

int main(){
	int value = *getAddress(5); // 사라질 변수를 de-referecing 하는 것은 위험이 있음.
 	 cout &lt;&lt; value &lt;&lt; endl;
	return 0;
}</code></pre>
<pre id="code_1644316533493" class="c++ arduino" data-ke-language="c++" data-ke-type="codeblock"><code>-831371064</code></pre>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16"><span style="font-family: 'Nanum Gothic'; color: #000000;">혹은 <span style="background-color: #333333; color: #ffffff;">포인터 변수를 이용해 변수의 주소값을 받는 방법</span>을 떠올릴 수 도 있습니다. 하지만 이 방식은 더 위험합니다.</span></p>
<p data-ke-size="size16"><span style="font-family: 'Nanum Gothic'; color: #000000;"><b>사라질 변수(getAddress의 value)의 주소값을 담고 있는 상황</b>이 되어 버리기 때문입니다.</span></p>
<pre id="code_1644316610164" class="c++ arduino" data-ke-language="c++" data-ke-type="codeblock"><code>#include &lt;iostream&gt;
using namespace std;

// return by address
int* getAddress(int x)
{
	int value = x * 2;
	return &amp;value;
}

int main(){
	int *value = getAddress(5);
	return 0;
}</code></pre>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16"><span style="font-family: 'Nanum Gothic'; color: #000000;">참조자(&amp;)의 경우도 마찬가지입니다. 아래처럼 코드를 작성하면 가비지값으로 초기화될 수 있습니다.</span></p>
<pre id="code_1644317285160" class="c++ arduino" data-ke-language="c++" data-ke-type="codeblock"><code>//return by refference
int&amp; getRef(int x)
{
	int value = x * 2;
	return value;
}

int main(){
	int value = getValue3(5);
	int &amp;value = getValue3(5); 
	return 0;
}</code></pre>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16"><span style="font-family: 'Nanum Gothic'; color: #000000;">이처럼 <b>리턴값이 임시적으로 생겼다가 사라지는 지역변수인 경우 위에 소개한 방식처럼 리턴하는 것은 예상치 못한 결과를 불러 일으킬 수 있습니다.</b></span></p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16"><span style="font-family: 'Nanum Gothic'; color: #000000;">단, 아래처럼 <b>메모리가 함수의 실행 여부에 영향을 받지 않고, 확실하게 잡혀있는 상태라면 참조자만을 보내는 것은 괜찮습니다.</b></span></p>
<pre id="code_1644317566932" class="c++ arduino" data-ke-language="c++" data-ke-type="codeblock"><code>int&amp; get(std::array&lt;int, 100&gt;&amp; my_array, int ix)
{
	return my_array[ix];
}

int main(){
	std::array&lt;int, 100&gt; my_array;
	get(my_array, 30) = 30;
	return 0;
}</code></pre>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16"><b><span style="font-family: 'Nanum Gothic'; color: #000000;">* 정리</span></b></p>
<p data-ke-size="size16"><span style="font-family: 'Nanum Gothic'; color: #000000;"><span style="background-color: #333333; color: #ffffff;">1. Return By Value</span> 방식은 간편하지만 복사가 많이 일어나 비효율적이라는 단점이 있다. 작은 크기의 데이터를 리턴하는 것은 문제가 되지 않지만 다수의 데이터를 갖고 있는 배열이나 구조체 같은 자료형을 리턴 시에는 문제가 될 수 있다.</span></p>
<p data-ke-size="size16"><span style="font-family: 'Nanum Gothic'; color: #000000;"><span style="background-color: #333333; color: #ffffff;">2. Return By Address/Reference</span> 방식의 함수에서 리턴값이 임시적으로 생겼다가 사라지는 지역변수인 경우 예상치 못한 결과를 불러 일으킬 수 있다. 단, 메모리가 함수의 실행 여부에 영향을 받지 않고 확실하게 잡혀 있는 상태에서 주소값/참조자를 보내는 것은 괜찮다.</span></p>
                        </div>
                        <br/>
                        <div class="tags">
                            #C #C++ #반환값주소 #반환값포인터 #반환값참조자 
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
</body>
</html>
